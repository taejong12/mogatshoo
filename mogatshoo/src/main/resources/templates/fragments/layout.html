<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
	<link rel="manifest" href="/webApp/manifest.json">
	<meta name="theme-color" content="#008080">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-title" content="ëª¨ê°“ìŠˆ">
	<link rel="apple-touch-icon" href="/img/logo/logo_192.png">
	<script th:src="@{/js/common/pwa.js}"></script>
	
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title layout:title-pattern="$LAYOUT_TITLE - $CONTENT_TITLE" th:text="${layoutTitle} ?: 'Mogatshoo'">Mogatshoo</title>

	<!-- ğŸ”¥ ê¸°ë³¸ CSSëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ -->
	<link th:href="@{/css/main/layout.css}" rel="stylesheet">
	<link th:href="@{/css/main/sidebar.css}" rel="stylesheet">
	<link th:href="@{/css/main/footer.css}" rel="stylesheet">
	
	<!-- ğŸ”¥ ëª¨ë°”ì¼ ì „ìš© CSS ì¶”ê°€ (ë®ì–´ì“°ê¸°ìš©) -->
	<link th:href="@{/css/mobile/mobile-override.css}" rel="stylesheet">

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<th:block layout:fragment="additionalStyles"></th:block>
	
	<!-- ğŸ”¥ ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ ìœ ì§€ -->
	<script>
		(function () {
			'use strict';

			const currentPath = window.location.pathname;
			const isInIframe = window.self !== window.top;
			const screenWidth = window.innerWidth;

			// ğŸ”¥ ëª¨ë°”ì¼ ê°ì§€ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
			const isMobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || screenWidth <= 768;

			console.log("ğŸ” í˜ì´ì§€ ì²´í¬:", {
				path: currentPath,
				iframe: isInIframe,
				screenWidth: screenWidth,
				isMobile: isMobileDevice
			});

			const iframeOnlyPaths = [
				'/hairLossTest/',
				'/fortune/',
				'/hospitalMap/',
				'/point/',
				'/member/mypage', '/member/complete', '/member/findById', '/member/findByPwd', '/member/lost', '/member/pwdUpdateForm', '/member/update',
				'/voting/', '/voting',
				'/qanda/'
			];

			const isIframeOnlyPath = iframeOnlyPaths.some(path => currentPath.startsWith(path));

			// ğŸ”¥ ëª¨ë°”ì¼ì—ì„œëŠ” ê¸°ì¡´ ë¡œì§ ëŒ€ì‹  ìƒˆë¡œìš´ ì²˜ë¦¬
			if (isMobileDevice) {
				console.log("ğŸ“± ëª¨ë°”ì¼ í™˜ê²½ ê°ì§€ - ëª¨ë°”ì¼ ì „ìš© ì²˜ë¦¬");
				// ëª¨ë°”ì¼ì—ì„œëŠ” ì•„ì´í”„ë ˆì„ ì œì•½ ë¬´ì‹œí•˜ê³  ëª¨ë“  ì½˜í…ì¸  í‘œì‹œ
				document.body.classList.add('mobile-mode');
			} else {
				// ë°ìŠ¤í¬í†±ì—ì„œëŠ” ê¸°ì¡´ ë¡œì§ ìœ ì§€
				if (isIframeOnlyPath && !isInIframe) {
					console.log("ğŸ—‘ï¸ ë°ìŠ¤í¬í†±ì—ì„œ ì§ì ‘ ì ‘ê·¼ ê°ì§€ - ì½˜í…ì¸  ìˆ¨ê¹€");
					hideContent();
				}
			}

			// ì•„ì´í”„ë ˆì„ì—ì„œëŠ” ê¸°ì¡´ ë¡œì§ ìœ ì§€
			if (isInIframe) {
				setTimeout(() => {
					const sidebar = document.querySelector('.sidebar');
					const footer = document.querySelector('.footer-area, .footer');

					if (sidebar) {
						sidebar.style.display = 'none';
						console.log("ğŸ”’ ì•„ì´í”„ë ˆì„: ì‚¬ì´ë“œë°” ìˆ¨ê¹€");
					}
					if (footer) {
						footer.style.display = 'none';
						console.log("ğŸ”’ ì•„ì´í”„ë ˆì„: í‘¸í„° ìˆ¨ê¹€");
					}

					const contentWithSidebar = document.querySelector('.content-with-sidebar');
					if (contentWithSidebar) {
						contentWithSidebar.style.marginLeft = '0';
						contentWithSidebar.style.width = '100%';
					}
				}, 100);
			}

			// ê¸°ì¡´ hideContent í•¨ìˆ˜ ìœ ì§€
			function hideContent() {
				const contentSelectors = [
					'[layout\\:fragment="content"]',
					'.content-with-sidebar > div',
					'.content-with-sidebar',
					'.main-container',
					'main .container',
					'.container .row',
					'.pixel-bg .main-container',
					'.retro-panel'
				];

				let contentFound = false;

				contentSelectors.forEach(selector => {
					const elements = document.querySelectorAll(selector);
					elements.forEach(element => {
						if (element && element.innerHTML.trim() !== '') {
							console.log("ğŸ—‘ï¸ ì½˜í…ì¸  ì œê±°:", selector);
							element.innerHTML = '';
							element.style.minHeight = 'calc(100vh - 200px)';
							element.style.backgroundColor = '#008080';
							element.style.display = 'flex';
							element.style.alignItems = 'center';
							element.style.justifyContent = 'center';
							contentFound = true;
						}
					});
				});

				if (!contentFound) {
					console.log("ğŸ”¨ ê°•ì œ ì½˜í…ì¸  ìˆ¨ê¹€");
					const style = document.createElement('style');
					style.textContent = `
			                .retro-panel,
			                .main-container > .container,
			                .pixel-bg .main-container > .container,
			                [layout\\:fragment="content"] > *,
			                .content-with-sidebar > div:not(.empty-space) {
			                    display: none !important;
			                }
			                
			                .content-with-sidebar {
			                    min-height: calc(100vh - 200px) !important;
			                    background-color: #008080 !important;
			                    display: flex !important;
			                    align-items: center !important;
			                    justify-content: center !important;
			                }
			            `;
					document.head.appendChild(style);
				}
				console.log("âœ… ì½˜í…ì¸  ìˆ¨ê¹€ ì™„ë£Œ");
			}
		})();
	</script>
</head>

<body th:classappend="${mainPage} ? 'main-page' : ''">
	<div class="page-container d-flex flex-column min-vh-100">

		<!-- ë³¸ë¬¸ ë° ì‚¬ì´ë“œë°” -->
		<main class="flex-fill content-area">
			<div class="content-wrapper container-fluid">
				<div class="sidebar-content-container d-flex">

					<!-- ğŸ”¥ ì¡°ê±´ë¶€ ì‚¬ì´ë“œë°”: ëª¨ë°”ì¼ì´ë©´ ëª¨ë°”ì¼ ì‚¬ì´ë“œë°”, ë°ìŠ¤í¬í†±ì´ë©´ ê¸°ì¡´ ì‚¬ì´ë“œë°” -->
					<aside class="sidebar desktop-sidebar" th:replace="~{fragments/sidebar :: sidebar}"></aside>
					<aside class="sidebar mobile-sidebar" th:replace="~{fragments/mobile-sidebar :: mobile-sidebar}"></aside>

					<!-- ì½˜í…ì¸  -->
					<section class="content-with-sidebar flex-grow-1">
						<!-- ë³¸ë¬¸ ì˜ì—­ -->
						<div layout:fragment="content"></div>
					</section>
				</div>
			</div>
		</main>

		<!-- í‘¸í„° -->
		<footer class="footer-area mt-auto">
			<div th:replace="~{fragments/footer :: footer}" class="footer"></div>
		</footer>
	</div>

	<!-- ğŸ”¥ ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ ìœ ì§€ -->
	<script th:src="@{/js/main/sidebar.js}"></script>
	<script th:src="@{/js/main/footer.js}"></script>
	
	<!-- ğŸ”¥ ëª¨ë°”ì¼ ì „ìš© ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ -->
	<script th:src="@{/js/mobile/mobile-sidebar.js}"></script>

	<th:block layout:fragment="additionalScripts"></th:block>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>